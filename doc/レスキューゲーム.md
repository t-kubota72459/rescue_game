# セットアップ

**レスキューゲームではコンセントが 3 口必要です。* USB 電源が 2 つ必要なので USB 電源が 2 つ以上あれば、コンセントは 2 口でもよいです。**

1. 基盤と Arduino ケーブルをつなぐ
1. 基盤と フィールドケーブルをつなぐ
1. 基盤に 12V(1A) AC アダプタをつなぐ
1. Arduino に USB (5V) 電源をつなぐ
2. Rasbperry Pi に USB (5V) 電源をつなぐ

Raspberry Pi ではレスキューゲームが自動起動する。

## 起動アカウント

レスキューゲームのアカウントは ```game```。

## Wifi 設定

校内にいるときには校内 Wifi に接続される。ホスト名は ```rescue-pi```。

```
ssh game@rescue-pi
```

でアクセスできる。

# レスキューゲーム起動設定

Raspberry Pi のプログラム自動起動機能 autostart を使用して電源 ON と同時にレスキューゲームが立ち上がる。

## autostart

設定ファイルは以下にある：
> /etc/xdg/autostart/rescue_game.desktop

```
[Desktop Entry]
Type=Application
Name=Rescue
Exec=/etc/xdg/autostart/startup.sh
```

### startup.sh シェルスクリプト

アカウント game にあるプログラムを起動する:
```
#!/bin/sh
DIR=/home/game/repos/rescue_game/src/raspberrypi
(cd $DIR; python main.py)
```

# フィールドマップ

スタートに近い順に A, B, C と命名されている。

# ゲーム

このとき、音声のボリュームを調整できる（ゲーム中はボリューム調整できない）。 

## ボタンの役割

### [とうろく] 

おなまえに入力された名前を記録し、フィールドのカプセルやセンサーの状態が初期状態になっているかを確認する。エラーが出たら状態を確認する。状態が正常であれば、生存者カプセルの位置が自動的にシャッフルされる。[とうろく] ボタンはゲーム開始前なら、何度でもやり直すことができる。  
[スタート] ボタンが有効になり、のこりじかんが 02:00 に設定される。

### [スタート]

ゲーム開始の BGM が流れる。スタートの光電センサーが H になる(ロボが動き出す) と、のこりじかんの減算が始まる。


# ゲーム終了条件

以下の３つの条件のいずれかが成立したとき：

- 成功　：生存者のカプセルが移動して、病院に２分以内に（どれか）カプセルが入る
- 時間切れ：のこりじかんが 0 になる
- 失敗：生存者のカプセルが放置されたままで、病院に２分以内に（どれか）カプセルが入る

# ランキング

- 成功したプレイヤーと時間切れプレイヤーはトップテンの成績がランキングされる
- 失敗はランキングされない

# Rasberry Pi ピンアサイン

- **すべて物理ピン番号**

|物理ピン番号| 用途 | 備考 |
|-----------|-----|------|
| 3 | Arduino SDA | |
| 5 | Arduino SCL | |
| 11 | A フィールド近接センサー |別基板のフォトカプラ経由 外部で pull-up
| 13 | C フィールド近接センサー |別基板のフォトカプラ経由 外部で pull-up
| 15 | B フィールド近接センサー |別基板のフォトカプラ経由 外部で pull-up
| 19 | スタート位置光電センサー | RP 内部 pull-up
| 21 | スタート位置光電センサー | RP 内部 pull-up
| 29 | B フィールド IR センサー (生命反応)| pull-up/pull-down なし
| 31 | C フィールド IR センサー (生命反応)| pull-up/pull-down なし
| 33 | A フィールド IR センサー (生命反応)| pull-up/pull-down なし

